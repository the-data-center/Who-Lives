library(censusapi) 
library(tidyverse)
library(dplyr)
library(extrafont)
library(scales)
library(directlabels)
library(grid)
library(here)
library(knitr)
library(readxl)
library(xfun)

#HT created this in the 2024 who lives to be a crosswalk to the Louisiana and US design factors to calculate error for the 2000's data in the wholivesdatapull2000 in the functions.R file.
Census2000_designfac <- read_xlsx("inputs/2000_census/Census2000SF3_designfac.xlsx")

#load("inputs/allparishesRawx.RData")

library(AzureAuth) ## to connect with credentials
library(AzureStor) ## to access the stored data

## install azure cli: https://docs.microsoft.com/en-us/cli/azure/install-azure-cli-windows?tabs=azure-cli
## sign in to Azure using your AAD un/pw in the terminal/commandline: az login 
## get token in terminal/commandline: az account get-access-token --resource https://datacenterdc2datalake.blob.core.windows.net/

### define your token 

token = "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ikg5bmo1QU9Tc3dNcGhnMVNGeDdqYVYtbEI5dyIsImtpZCI6Ikg5bmo1QU9Tc3dNcGhnMVNGeDdqYVYtbEI5dyJ9.eyJhdWQiOiJodHRwczovL2RhdGFjZW50ZXJkYzJkYXRhbGFrZS5ibG9iLmNvcmUud2luZG93cy5uZXQvIiwiaXNzIjoiaHR0cHM6Ly9zdHMud2luZG93cy5uZXQvNzQ5YzFmYmEtMmMyOS00YTBmLTg3ZGEtODc3NjQ3YmJiZDg2LyIsImlhdCI6MTcyNjYyNDY2MiwibmJmIjoxNzI2NjI0NjYyLCJleHAiOjE3MjY2Mjk4NDYsImFjciI6IjEiLCJhaW8iOiJBWlFBYS84WEFBQUFLc2dWK0ppZHhRdThaWmdJQldYbnFiQjZzOUJHckxramp4U3UvK3FXc2xlVzZOdjVVTCtYTk9iR3FGVUcxem5WMGdXSURmNG1BK05aaWxFaXA1NWIyd1ZGU1YzZ1RBbmN3UENHZEhubzgxc2NxdDQrSE55bjlZaG1wdGwreEVmbm5PNGFZcjByajBYb2I1YnovbC85M0I0TVE3MGFyc0dUcnhjU0YzMFhQeXhHOElRVnFjVDJKZnF5SytkSWV6OFMiLCJhbXIiOlsicnNhIiwibWZhIl0sImFwcGlkIjoiMDRiMDc3OTUtOGRkYi00NjFhLWJiZWUtMDJmOWUxYmY3YjQ2IiwiYXBwaWRhY3IiOiIwIiwiZGV2aWNlaWQiOiJiNWRjNGRlYS1lODE0LTQ4MTAtYWUyYS1lMzcyODc1ZjA1NTUiLCJmYW1pbHlfbmFtZSI6IlRvbWxpbiIsImdpdmVuX25hbWUiOiJIYWxlaWdoIiwiZ3JvdXBzIjpbIjc3MmM0NzFjLWU1ZDMtNGViNC1hNmExLWRmOWRlZjk2MWZlYyIsImFkMDk0OGFjLWFmNjgtNDQ5NS04Y2NkLTQxNGMzY2NmZjM3MyJdLCJpZHR5cCI6InVzZXIiLCJpcGFkZHIiOiIyNC4yNTIuMTA4LjE4NiIsIm5hbWUiOiJIYWxlaWdoIFRvbWxpbiIsIm9pZCI6IjE4OTgxMjUzLTQxNjQtNDkyMC1hMWI5LTE5YjA2NzE4MDVmMSIsInB1aWQiOiIxMDAzMjAwMjFFRTAzNjQ3IiwicHdkX3VybCI6Imh0dHBzOi8vcG9ydGFsLm1pY3Jvc29mdG9ubGluZS5jb20vQ2hhbmdlUGFzc3dvcmQuYXNweCIsInJoIjoiMC5BU2tBdWgtY2RDa3NEMHFIMm9kMlI3dTlob0dtQnVUVTg2aENrTGJDc0NsSmV2RXBBSDguIiwic2NwIjoidXNlcl9pbXBlcnNvbmF0aW9uIiwic3ViIjoiejlNcXBEeWdRMW9yYUVnR3R0WVE3enl2NHMxVTlqY3B0UHc1LUJKMWZPZyIsInRpZCI6Ijc0OWMxZmJhLTJjMjktNGEwZi04N2RhLTg3NzY0N2JiYmQ4NiIsInVuaXF1ZV9uYW1lIjoiSGFsZWlnaHRAZGF0YWNlbnRlcnJlc2VhcmNoLm9yZyIsInVwbiI6IkhhbGVpZ2h0QGRhdGFjZW50ZXJyZXNlYXJjaC5vcmciLCJ1dGkiOiI0cmdVZ0V1T1ZFQzFCbml4R2I3R0FBIiwidmVyIjoiMS4wIiwieG1zX2lkcmVsIjoiMTQgMSJ9.R9G_Iki_SlvzrbpSjR6dJ3qMIDZZu8Y3NXS-kMRLnpwfB8JvkhkxfHabECPN7OfpY4cBEiE6jvJLEbT631qi2Ua_e-cNJXX1UHbWGHvUAoAYN32eAEIbEwfTFW2_fOdGE7PBabjDCQc2H1CLNIjd_fcsA1MWMYYfchC45MErLsVtV8OZtbLP84JrzUjH_S7IeZS1aMNTpz6ii6zhmxgKp9wBuxf5_GDBd0a218132yF9OMIrMhCQFk7OUTl7n1bQcZQvDI6NuJhX-fkn2ObdNApcfJL9vmkhXjxcVqDAX1wxnLXGQBFpmLM8Lcqqby1HoAPToIJs4ruNhQBsHwGPkA"

ad_endp_tok2 <- storage_endpoint("https://datacenterdc2datalake.blob.core.windows.net/", token=token) ## again, the rsource/URL

## Connections to some most-used containers.
cont_proj <- storage_container(ad_endp_tok2, "project") 
#df <- storage_read_csv(cont_proj, "who_lives/2022/inputs/WhoLives_longer.csv") %>% select(-1) #make sure this is updated within datalake - querying_WhoLives_factconsolidated

#to write back to azure, use storage_write_csv(df, cont_proj, "who_lives/2022/outputs/file_name")
